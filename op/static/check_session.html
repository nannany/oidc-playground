<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Check Session</title>
    <script>
        window.addEventListener("message", receiveMessage, false);

        function receiveMessage(e) { // e.data has client_id and session_state

            console.log('op iframe received message from RP iframe');

            var client_id = e.data.substr(0, e.data.lastIndexOf(' '));
            var session_state = e.data.substr(e.data.lastIndexOf(' ') + 1);

            console.log(client_id, session_state);

            // openid provider の cookie から op_session_state を取得
            var op_session_state = document.cookie.split('; ').find(row => row.startsWith('op_session_state'));
            var opuas = op_session_state;

            // Here, the session_state is calculated in this particular way,
            // but it is entirely up to the OP how to do it under the
            // requirements defined in this specification.
            var ss = opuas;

            var stat = '';
            if (session_state === ss) {
                stat = 'unchanged';
            } else {
                stat = 'changed';
            }

            console.log(stat)
            e.source.postMessage(stat, e.origin);
        };
    </script>
</head>
<body>
<h1>Check Session</h1>
</body>
</html>