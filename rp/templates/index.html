<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }}</title>
    <script>
        var stat = "unchanged";
        var mes = "web" + " " + session_state;
        var targetOrigin = "http://localhost:8080"; // Validates origin
        var opFrameId = "op";
        var timerID;

        function check_session()   {
            var win = window.parent.frames[opFrameId].contentWindow
            win.postMessage(mes, targetOrigin);
        }

        function setTimer() {
            check_session();
            timerID = setInterval(check_session, 5 * 1000);
        }

        window.addEventListener("message", receiveMessage, false);

        function receiveMessage(e) {
            if (e.origin !== targetOrigin) {
                return;
            }
            stat = e.data;

            if (stat === "changed") {
                clearInterval(timerID);
                // then take the actions below...
            }
        }

        setTimer();
    </script>
</head>
<body>
<h1>{{ .Message }}</h1>

<iframe src="http://localhost:8080/check_session_iframe" style="display:none"></iframe>
</body>
</html>